# SPDX-FileCopyrightText: 2025 Alexandre Gomes Gaigalas <alganet@gmail.com>
#
# SPDX-License-Identifier: ISC

[general]
listen = "127.0.0.1:3000"
captures = "captures.jsonl"
ttl_seconds = 300
captures_seed = false
# When true, captured request/response bodies are included in the captures JSONL
# file as base64 strings. Bodies are still captured in memory for rules; this
# option only affects serialization to the captures file.
captures_include_body = false

[tls]
enabled = true
ca_cert_path = "ca.crt"
ca_key_path = "ca.key" 
passthrough_domains = ["example.com"]
suppress_headers = ["X-Sensitive-Header"]


# Client Rules
[rules.client_accept_encoding_present]
enabled = true
severity = "info"

[rules.client_user_agent_present]
enabled = true
severity = "info"

[rules.client_sec_websocket_headers_consistency]
enabled = false
severity = "warn"

[rules.client_cache_respect]
enabled = true
severity = "warn"

[rules.message_connection_upgrade]
enabled = true
severity = "warn"

# Server Rules
[rules.server_cache_control_present]
enabled = true
severity = "warn"

[rules.server_status_and_caching_semantics]
enabled = true
severity = "warn"

[rules.server_etag_or_last_modified]
enabled = true
severity = "info"

[rules.message_etag_syntax]
enabled = true
severity = "warn"

[rules.server_last_modified_rfc1123_format]
enabled = true
severity = "warn"

[rules.server_location_header_uri_valid]
enabled = true
severity = "warn"

[rules.server_response_location_on_redirect]
enabled = true
severity = "warn"

[rules.server_redirect_status_and_location_validity]
enabled = true
severity = "warn"

[rules.stateful_redirect_chain_validity]
enabled = true
severity = "warn"

[rules.stateful_websocket_handshake_validity]
enabled = true
severity = "warn"

[rules.stateful_103_early_hints_before_final]
enabled = true
severity = "warn"

[rules.server_3xx_vs_request_method]
enabled = true
severity = "warn"

[rules.server_x_content_type_options]
enabled = true
severity = "warn"
content_types = ["text/html", "application/javascript", "application/json"]

[rules.server_x_frame_options_value_valid]
enabled = true
severity = "warn"

[rules.server_x_xss_protection_value_valid]
enabled = true
severity = "warn"

[rules.server_content_security_policy_validity]
enabled = true
severity = "warn"

[rules.message_content_security_policy_and_frame_options_consistency]
enabled = true
severity = "warn"

[rules.message_strict_transport_security_validity]
enabled = true
severity = "warn"

[rules.server_response_405_allow]
enabled = true
severity = "warn"

[rules.server_charset_specification]
enabled = true
severity = "warn"

[rules.server_clear_site_data]
enabled = true
severity = "warn"
paths = ["/logout", "/signout", "/auth/logout", "/api/v1/logout"]

# Correctness rules examples
[rules.client_host_header]
enabled = true
severity = "warn"

[rules.client_request_method_token_valid]
enabled = true
severity = "warn"

[rules.client_request_version_method_validity]
enabled = true
severity = "warn"

[rules.client_patch_method_content_type_match]
enabled = true
severity = "warn"

[rules.semantic_patch_partial_update]
enabled = true
severity = "warn"

[rules.message_user_agent_token_valid]
enabled = true
severity = "warn"

[rules.client_expect_header_valid]
enabled = true
severity = "error"

[rules.client_request_target_no_fragment]
enabled = true
severity = "error"

[rules.client_request_target_form_checks]
enabled = true
severity = "error"

[rules.server_accept_ranges_values_valid]
enabled = true
severity = "warn"

[rules.server_vary_header_valid]
enabled = true
severity = "warn"

[rules.server_vary_and_cache_consistency]
enabled = true
severity = "warn"

[rules.server_patch_accept_patch_header]
enabled = true
severity = "warn"

[rules.server_server_timing_header_syntax]
enabled = true
severity = "warn"

[rules.server_priority_and_cacheability_consistency]
enabled = true
severity = "warn"

[rules.server_authentication_challenge_validity]
enabled = true
severity = "warn"

[rules.semantic_status_code_semantics]
enabled = true
severity = "warn"

[rules.semantic_post_creates_resource]
enabled = true
severity = "warn"

[rules.semantic_head_response_headers_match_get]
enabled = true
severity = "warn"
headers = ["etag", "content-type", "content-length"]

[rules.semantic_trace_method_echo]
enabled = true
severity = "warn"

[rules.semantic_options_method_capabilities]
enabled = true
severity = "warn"

[rules.server_keep_alive_timeout_reasonable]
enabled = true
severity = "warn"
max_timeout_seconds = 3600

[rules.server_200_vs_204_body_consistency]
enabled = true
severity = "warn"

[rules.message_sec_fetch_user_value_valid]
enabled = true
severity = "warn"

[rules.message_sec_fetch_dest_value_valid]
enabled = true
severity = "warn"

[rules.message_origin_isolated_header_validity]
enabled = true
severity = "warn"

[rules.server_deprecation_header_syntax]
enabled = true
severity = "warn"

[rules.server_alt_svc_header_syntax]
enabled = true
severity = "warn"

[rules.server_alt_svc_protocol_iana_registered]
enabled = true
severity = "warn"
allowed = ["h2", "h3", "h2c", "ws", "wss"]

[rules.server_problem_details_content_type]
enabled = true
severity = "warn"

[rules.message_problem_details_structure]
enabled = true
severity = "warn"

[rules.server_must_revalidate_and_immutable_mismatch]
enabled = true
severity = "warn"

[rules.message_server_header_product_valid]
enabled = true
severity = "warn"

[rules.client_range_header_syntax_valid]
enabled = true
severity = "error"

[rules.client_accept_ranges_on_partial_content]
enabled = true
severity = "warn"

[rules.message_range_and_content_range_consistency]
enabled = true
severity = "warn"

[rules.message_accept_ranges_and_206_consistency]
enabled = true
severity = "warn"

[rules.client_request_uri_percent_encoding_valid]
enabled = true
severity = "error"

[rules.client_request_origin_header_present_for_cors]
enabled = true
severity = "warn"

[rules.semantic_origin_matching_for_cors]
enabled = true
severity = "warn"

[rules.server_content_type_present]
enabled = true
severity = "warn"

[rules.message_content_type_well_formed]
enabled = true
severity = "warn"

[rules.message_content_type_iana_registered]
enabled = true
severity = "warn"
allowed = ["text/plain", "application/json", "image/*", "+json"]

[rules.message_media_type_suffix_validity]
enabled = true
severity = "warn"
allowed = ["json", "xml", "ber", "der", "fastinfoset", "wbxml", "exi"]

[rules.message_charset_iana_registered]
enabled = true
severity = "warn"
allowed = ["utf-8", "iso-8859-1", "us-ascii"]

[rules.message_content_encoding_and_type_consistency]
enabled = true
severity = "warn"

[rules.message_multipart_boundary_syntax]
enabled = true
severity = "warn"

[rules.message_date_and_time_headers_consistency]
enabled = true
severity = "warn"

[rules.message_sunset_and_deprecation_consistency]
enabled = true
severity = "warn"

[rules.message_accept_and_content_type_negotiation]
enabled = true
severity = "warn"

[rules.message_cache_control_token_valid]
enabled = true
severity = "warn"

[rules.message_expires_and_cache_control_consistency]
enabled = true
severity = "warn"

[rules.message_cache_control_directive_validity]
enabled = true
severity = "warn"

[rules.message_caching_directive_interaction]
enabled = true
severity = "warn"

[rules.message_cache_control_and_pragma_consistency]
enabled = true
severity = "warn"

[rules.message_pragma_token_valid]
enabled = true
severity = "warn"

[rules.message_content_disposition_token_valid]
enabled = true
severity = "warn"

[rules.message_content_disposition_parameter_validity]
enabled = true
severity = "warn"

[rules.message_form_data_content_disposition_valid]
enabled = true
severity = "warn"

[rules.message_accept_header_media_type_syntax]
enabled = true
severity = "warn"

[rules.message_language_tag_format_valid]
enabled = true
severity = "warn"

[rules.message_accept_language_weight_validity]
enabled = true
severity = "warn"

[rules.message_early_data_header_safe_method]
enabled = true
severity = "warn"

[rules.message_priority_header_syntax]
enabled = true
severity = "warn"

[rules.message_structured_headers_validity]
enabled = true
severity = "warn"
headers = ["Priority", "Permissions-Policy"]

[rules.message_permissions_policy_directives_valid]
enabled = true
severity = "warn"

[rules.message_referer_uri_valid]
enabled = true
severity = "warn"

[rules.message_content_location_and_uri_consistency]
enabled = true
severity = "warn"

[rules.message_well_known_uri_format]
enabled = true
severity = "warn"

[rules.message_link_header_validity]
enabled = true
severity = "warn"

[rules.message_from_header_email_syntax]
enabled = true
severity = "warn"

[rules.message_access_control_allow_credentials_when_origin]
enabled = true
severity = "warn"

[rules.message_access_control_allow_origin_valid]
enabled = true
severity = "warn"

[rules.message_timing_allow_origin_validity]
enabled = true
severity = "warn"

[rules.message_forwarded_header_validity]
enabled = true
severity = "warn"

[rules.message_x_forwarded_consistency]
enabled = true
severity = "warn"

[rules.message_cross_origin_opener_policy_valid]
enabled = true
severity = "warn"
[rules.message_sec_fetch_site_value_valid]
enabled = true
severity = "warn"

[rules.message_sec_fetch_mode_value_valid]
enabled = true
severity = "warn"

[rules.message_cross_origin_resource_policy_valid]
enabled = true
severity = "warn"

[rules.message_cross_origin_embedder_policy_valid]
enabled = true
severity = "warn"

[rules.message_content_encoding_iana_registered]
enabled = true
severity = "warn"
allowed = ["aes128gcm", "br", "compress", "dcb", "dcz", "deflate", "exi", "gzip", "identity", "pack200-gzip", "x-compress", "x-gzip", "zstd"]

[rules.message_accept_encoding_parameter_validity]
enabled = true
severity = "warn"

[rules.message_transfer_coding_iana_registered]
enabled = true
severity = "warn"
allowed = ["chunked", "gzip", "deflate"]

[rules.message_compression_and_transfer_encoding_consistency]
enabled = true
severity = "warn"

[rules.message_content_transfer_encoding_valid]
enabled = true
severity = "warn"

[rules.message_te_header_constraints]
enabled = true
severity = "warn"

[rules.message_trailer_headers_valid]
enabled = true
severity = "warn"

[rules.message_digest_header_syntax]
enabled = true
severity = "warn"

[rules.message_content_md5_vs_digest_preference]
enabled = true
severity = "warn"

[rules.message_warning_header_syntax]
enabled = true
severity = "warn"

[rules.message_www_authenticate_challenge_syntax]

[rules.message_auth_scheme_iana_registered]
enabled = true
severity = "warn"
allowed = ["Basic", "Bearer", "Digest"]

[rules.message_authorization_credentials_present]
enabled = true
severity = "warn"

[rules.message_digest_auth_validity]
enabled = true
severity = "warn"

[rules.message_bearer_token_format_validity]
enabled = true
severity = "warn"

[rules.message_basic_auth_base64_validity]
enabled = true
severity = "warn"

[rules.message_cookie_attribute_consistency]
enabled = true
severity = "warn"

[rules.message_cookie_path_validity]
enabled = true
severity = "warn"

[rules.message_cookie_domain_validity]
enabled = true
severity = "warn"

[rules.message_if_none_match_etag_syntax]
enabled = true
severity = "warn"

[rules.message_if_match_etag_syntax]
enabled = true
severity = "warn"

[rules.message_if_modified_since_date_format]
enabled = true
severity = "warn"

[rules.message_if_unmodified_since_date_format]
enabled = true
severity = "warn"

[rules.message_conditional_headers_consistency]
enabled = true
severity = "warn"

[rules.stateful_conditional_request_handling]
enabled = true
severity = "warn"

[rules.message_http_version_syntax_valid]
enabled = true
severity = "error"

[rules.message_http2_pseudo_headers_validity]
enabled = true
severity = "error"

[rules.message_content_length_vs_transfer_encoding]
enabled = true
severity = "warn"

[rules.message_content_length]
enabled = true
severity = "warn"

[rules.message_response_body_length_accuracy]
enabled = true
severity = "error"

[rules.message_request_body_length_accuracy]
enabled = true
severity = "error"

[rules.message_multipart_content_type_and_body_consistency]
enabled = true
severity = "warn"

[rules.message_header_field_names_token]
enabled = true
severity = "warn"

[rules.message_extension_headers_registered]
enabled = true
severity = "warn"
allowed = ["host", "content-type", "user-agent", "x-custom"]

[rules.message_transfer_encoding_chunked_final]
enabled = true
severity = "warn"

[rules.message_via_header_syntax_valid]
enabled = true
severity = "warn"

[rules.message_connection_header_tokens_valid]
enabled = true
severity = "warn"

[rules.message_retry_after_date_or_delay]
enabled = true
severity = "warn"

[rules.server_retry_after_status_validity]
enabled = true
severity = "warn"

[rules.message_refresh_header_syntax_valid]
enabled = true
severity = "warn"

[rules.message_prefer_header_valid]
enabled = true
severity = "warn"

[rules.message_preference_applied_header_valid]
enabled = true
severity = "warn"

[rules.client_prefer_header_and_preference_applied]
enabled = true
severity = "warn"

[rules.message_max_forwards_numeric]
enabled = true
severity = "warn"

[rules.message_age_header_numeric]
enabled = true
severity = "warn"

[rules.message_allow_header_method_tokens]
enabled = true
severity = "error"

[rules.server_no_body_for_1xx_204_304]
enabled = true
severity = "error"

[rules.server_status_code_valid_range]
enabled = true
severity = "error"
